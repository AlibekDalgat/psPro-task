# Тестовое задание для стажёра-разработчика Go в PostgresPro

<!-- ToC start -->
# Описание задачи
Разработать приложение, которое будет предоставлять REST API для запуска команд. Команда представляет собой bash-скрипт. Приложение должно позволять параллельно запускать произвольное количество команд.

# Требования по функционалу
- Создание новой команды. Запускает переданную bash-команду, сохраняет результат выполнения в БД.
- Получение списка команд
- Получение одной команды
# Дополнительный функционал
- Остановка выполнения команды
- Возобновление выполнения команды
- Завершение ("убийство") команды
- Поддержка долгих команд (запись стандартного вывода и стандартного вывода ошибок в БД каждые 3 секунды в процесса выполнения команды)

# Реализация
- Применение фреймворка [gin-gonic/gin](https://github.com/gin-gonic/gin).
- Применение СУБД Postgres посредствов библиотеки [sqlx](https://github.com/jmoiron/sqlx) и написанием SQL запросов.
- Контейнеризация с помощью Docker и docker-compose

**Структура проекта:**
```
.
├── internal
│   ├── app         // точка запуска приложения
│   ├── config      // общие конфигурации приложения
│   ├── delivery    // слой обработки запросов
│   ├── models      // структуры сущностей приложения
│   ├── service     // слой бизнес-логики
│   └── repository  // слой взаимодействия с БД
├── cmd             // точка входа в приложение
└── db              // SQL файлы миграции
```

# Endpoints
- POST /api - создание и запуск команды
    - Тело запроса:
      - script - скрипт команды
    - Тело ответа:
      - id - идентификатор созданной команды
- GET /api - получение списка команд
  - Тело ответа:
    - Список команд:
      - id - идентификатор команды
      - script - скрипт команды
      - created_at - дата создания команды
- GET /api/comm?= - получение одной команды
    - Параметр запроса:
      - title - идентификатор команды
    - Тело ответа:
      - id - идентификатор команды
      - script - скрипт команды
      - created_at - дата создания команды
      - executed_at - время выполнения команды
      - stdout - стандартный вывод
      - stderr - стандартный вывод ошибок
- PATHC /api/stop/id - остановка выполнения команды
    - Параметры запроса:
      - id - идентификатор запроса
- PATHC /api/start/id - возобновление выполнения команды
    - Параметры запроса:
      - id - идентификатор запроса
- PATHC /api/kill/id - заврешение выполнения команды
    - Параметры запроса:
      - id - идентификатор запроса
     
# Запуск
```
make build && make run
```
Если приложение запускается впервые, необходимо применить миграции к базе данных (до отправки запроса на сервер):
```
make migrate-up
```
Запуск тестов
```
make test
```

# Примеры
Запросы сгенерированы командой curl
### 1. POST /api
**Запрос:**
```
curl --location --request POST 'localhost:8000/api' \
--header 'Content-Type: application/json' \
--data-raw '{
    "script": "echo example"
}'
```
**Тело ответа:**
```
{
    "id": 2
}
```
### 2. GET /api
**Запрос:**
```
curl --location --request GET 'localhost:8000/api'
```
**Тело ответа:**
```
[
  {
    "id": 2,
    "script": "echo example",
    "created_at": "2024-05-14T09:36:15.177091Z"
  }
]
```
### 3. GET /api/comm
**Запрос:**
```
curl --location --request GET 'localhost:8000/api/comm?id=2'
```
**Тело ответа:**
```
{
  "id": 2,
  "script": "echo ",
  "created_at": "2024-05-14T09:36:15.177091Z",
  "executed_at": "2024-05-14T09:37:38.019294Z",
  "stdout": "example\n",
  "stderr": null
}
```
### 4. PATCH /api/stop/1
**Запрос:**
```
curl --location --request PATCH 'localhost:8000/api/stop/1'
```
**Тело ответа:**
```
{
    "status": "Сигнал отправлен"
}
```
### 5. PATCH /api/start/1
**Запрос:**
```
curl --location --request PATCH 'localhost:8000/api/start/1'
```
**Тело ответа:**
```
{
    "status": "Сигнал отправлен"
}
```
### 6. PATCH /api/kill/1
**Запрос:**
```
curl --location --request PATCH 'localhost:8000/api/kill/1'
```
**Тело ответа:**
```
{
    "status": "Сигнал отправлен"
}
```
